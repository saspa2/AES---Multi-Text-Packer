<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨Ø³ØªÙ‡ Ú†Ù†Ø¯Ù…ØªÙ†ÛŒ Ø¨Ø§ AES</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 24px 28px 40px;
      direction: rtl;
      text-align: right;
      color: #222;
    }

    body[dir="ltr"] {
      direction: ltr;
      text-align: left;
    }

    /* Ø³ÙˆÛŒÛŒÚ† Ø²Ø¨Ø§Ù†: Ø¯Ùˆ Ø¯Ú©Ù…Ù‡ Ø¨Ø§ Ù¾Ø±Ú†Ù… */
    .lang-switcher {
      position: fixed;
      top: 12px;
      left: 16px;
      display: flex;
	  flex-direction: column;
	  align-items: flex-start;  /* Ø¨Ù‡ØªØ± Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª Ø¹Ù…ÙˆØ¯ÛŒ */
      gap: 6px;
      font-size: 0.85rem;
      background: rgba(255, 255, 255, 0.9);
      padding: 4px 8px;
      border-radius: 999px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.12);
      z-index: 20;
    }

    .lang-switcher-label {
      margin-inline-end: 4px;
      white-space: nowrap;
    }

    .lang-btn {
      border: 1px solid #ccc;
      border-radius: 999px;
      padding: 2px 10px;
      background: #fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font: inherit;
      font-size: 0.8rem;
      white-space: nowrap;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.08s ease;
    }

    .lang-btn .flag {
      font-size: 1rem;
      line-height: 1;
    }

    .lang-btn.active {
      background: #1976d2;
      color: #fff;
      border-color: #1976d2;
    }

    .lang-btn.active .flag {
      filter: drop-shadow(0 0 1px rgba(0, 0, 0, 0.4));
    }

    .lang-btn:active {
      transform: scale(0.97);
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
    }

    p.description {
      text-align: center;
      margin: 0 0 18px;
      font-size: 0.9rem;
      color: #444;
    }

    hr {
      margin: 24px 0 28px;
      border: none;
      border-top: 1px solid #ddd;
    }

    h2 {
      font-size: 1rem;
      margin-bottom: 10px;
    }

    .section {
      margin-bottom: 64px;
    }

    .columns-header {
      display: flex;
      justify-content: space-between;
      font-weight: 600;
      font-size: 0.92rem;
      margin-bottom: 8px;
      color: #444;
    }

    .columns-header span:first-child {
      margin-left: 32px;
    }

    #pairsContainer {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }

    .pair-row {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 0.9fr) 34px;
      gap: 8px;
      align-items: stretch;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      background: #fafafa;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-group label {
      font-size: 0.8rem;
      color: #555;
    }

    .field-group textarea,
    .field-group input {
      font: inherit;
      border-radius: 8px;
      border: 1px solid #d0d0d0;
      padding: 7px 9px;
      box-sizing: border-box;
      resize: vertical;
      min-height: 80px;
    }

    .field-group input {
      min-height: 0;
      height: 34px;
    }

    .text-group textarea {
      min-height: 140px;
    }

    .key-group input {
      min-height: 0;
    }

    .remove-btn {
      align-self: flex-start;
      margin-top: 24px;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      background: #ffe8e8;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #b00020;
    }

    .remove-btn:hover {
      background: #ffd2d2;
    }

    .rows-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 12px;
    }

    .rows-footer-left {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .btn,
    .danger-btn {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font: inherit;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #1976d2;
      color: #fff;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .btn:hover {
      background: #155a9e;
    }

    .danger-btn {
      background: #d32f2f;
    }

    .danger-btn:hover {
      background: #b71c1c;
    }

    .note {
      font-size: 0.86rem;
      color: #555;
      margin: 4px 0 6px;
    }

    textarea#packageText,
    textarea#openedPlain {
      width: 100%;
      box-sizing: border-box;
      font: inherit;
      border-radius: 8px;
      border: 1px solid #d0d0d0;
      padding: 8px 10px;
      min-height: 120px;
      resize: vertical;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 16px;
    }

    .controls-row > span {
      font-size: 0.85rem;
      color: #444;
    }

    .small-input {
      max-width: 260px;
    }

    .help-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
    }

    .help-icon {
      border: none;
      padding: 0;
      margin: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      font-size: 0.8rem;
      line-height: 1;
      cursor: default;
      background: #e0e0e0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .tooltip-bubble {
      position: absolute;
      bottom: 120%;
      right: 0;
      max-width: 260px;
      font-size: 0.8rem;
      line-height: 1.5;
      background: #333;
      color: #fff;
      padding: 6px 8px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
      opacity: 0;
      pointer-events: none;
      transform: translateY(4px);
      transition: opacity 0.15s ease, transform 0.15s ease;
      z-index: 10;
      white-space: normal;
    }

    .tooltip-bubble.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .result-text {
      margin-top: 6px;
      font-size: 0.9rem;
      color: #444;
      min-height: 1.2em;
    }

    .mono {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .row-btn {
      border: none;
      background: none;
      padding: 0;
      cursor: pointer;
      border-radius: 999px;
      font: inherit;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.88rem;
    }

    .row-btn span.icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #1976d2;
      color: #fff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .row-btn.danger span.icon {
      background: #d32f2f;
    }

    @media (max-width: 760px) {
      body {
        margin: 16px 14px 28px;
      }

      .pair-row {
        grid-template-columns: minmax(0, 1fr);
      }

      .remove-btn {
        margin-top: 4px;
        justify-self: flex-end;
      }

      .text-group textarea {
        min-height: 120px;
      }

      .columns-header {
        display: none;
      }

      .rows-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <!-- Ø³ÙˆÛŒÛŒÚ† Ø²Ø¨Ø§Ù†: Ø¯Ùˆ Ø¯Ú©Ù…Ù‡ Ø¨Ø§ Ù¾Ø±Ú†Ù… -->
  <div class="lang-switcher">
    <span class="lang-switcher-label" id="langSelectLabel">Ø²Ø¨Ø§Ù† Ø±Ø§Ø¨Ø·:</span>
    <button type="button" class="lang-btn active" data-lang="fa" id="langBtnFa">
      <span class="flag">ğŸ‡®ğŸ‡·</span>
      <span id="langBtnFaText">ÙØ§Ø±Ø³ÛŒ</span>
    </button>
    <button type="button" class="lang-btn" data-lang="en" id="langBtnEn">
      <span class="flag">ğŸ‡¬ğŸ‡§</span>
      <span id="langBtnEnText">English</span>
    </button>
  </div>

  <h1 id="appTitle">Ø¨Ø³ØªÙ‡Ù” Ú†Ù†Ø¯Ù…ØªÙ†ÛŒ Ø¨Ø§ AES</h1>
  <p class="description" id="appDescription">
    Ù‡Ø± Ø±Ø¯ÛŒÙ ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ùˆ ÛŒÚ© Ø±Ù…Ø² Ø¯Ø§Ø±Ø¯. Ø¨Ø³ØªÙ‡Ù” Ù†Ù‡Ø§ÛŒÛŒ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¨Ø§ Ù‡Ø± Ú©Ø¯Ø§Ù… Ø§Ø² Ø±Ù…Ø²Ù‡Ø§ Ø¨Ø§Ø² Ú©Ø±Ø¯ Ùˆ ÙÙ‚Ø· Ø¬Ù…Ù„Ù‡Ù” Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ù…Ø§Ù† Ø±Ù…Ø² Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
  </p>

  <hr />

  <!-- 1) ØªØ¹Ø±ÛŒÙ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ùˆ Ø±Ù…Ø²Ù‡Ø§ -->
  <div class="section" id="section-define">
    <h2 id="section1Title">Û±) ØªØ¹Ø±ÛŒÙ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ùˆ Ø±Ù…Ø²Ù‡Ø§</h2>

    <div class="columns-header">
      <span id="columnsKeysLabel">Ø±Ù…Ø²Ù‡Ø§</span>
      <span id="columnsTextsLabel">Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§</span>
    </div>

    <div id="pairsContainer"></div>

    <div class="rows-footer">
      <div class="rows-footer-left">
        <button id="addRowBtn" class="row-btn">
          <span class="icon">+</span>
          <span id="addRowBtnText">Ø§ÙØ²ÙˆØ¯Ù† Ø¬Ù…Ù„Ù‡Ù” Ø¬Ø¯ÛŒØ¯</span>
        </button>
      </div>

      <button id="clearRowsBtn" class="danger-btn">Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ù‡Ù…Ù‡Ù” Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§</button>
    </div>
  </div>

  <!-- 2) Ø³Ø§Ø®Øª Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ -->
  <div class="section">
    <h2 id="section2Title">Û²) Ø³Ø§Ø®Øª Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡</h2>
    <p class="note" id="packageNote">Ù…ØªÙ† Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù¾ÛŒ Ú©Ù†):</p>

    <div class="controls-row">
      <button id="encryptBtn">ØªÙˆÙ„ÛŒØ¯ Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ Ø§Ø² Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ùˆ Ø±Ù…Ø²Ù‡Ø§</button>
      <span id="encryptStatus" class="result-text"></span>
    </div>

    <div class="controls-row">
      <span id="minRecordsLabel">Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø¨Ø³ØªÙ‡:</span>
      <input id="minRecordsInput" type="number" class="small-input" min="1" step="1" value="111" />
      <span class="help-wrapper">
        <button type="button" id="minRecordsHelp" class="help-icon" aria-label="Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¯Ø±Ø¨Ø§Ø±Ù‡Ù” Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§">ØŸ</button>
        <span class="tooltip-bubble" id="minRecordsTooltip">
          Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø¨Ø³ØªÙ‡ (Ø¬Ù…Ù„Ù‡Ù” ÙˆØ§Ù‚Ø¹ÛŒ + Ø¬Ù…Ù„Ù‡Ù” padding). Ø¹Ø¯Ø¯ Ø¨Ø²Ø±Ú¯â€ŒØªØ±ØŒ Ø­Ø¯Ø³â€ŒØ²Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ Ø³Ø®Øªâ€ŒØªØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
        </span>
      </span>
    </div>

    <textarea id="packageText" placeholder="Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ÛŒØ§ Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡..."></textarea>
  </div>

  <!-- 3) Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ø³ØªÙ‡ Ø¨Ø§ ÛŒÚ© Ø±Ù…Ø² -->
  <div class="section">
    <h2 id="section3Title">Û³) Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ø³ØªÙ‡ Ø¨Ø§ ÛŒÚ© Ø±Ù…Ø²</h2>

    <div class="controls-row">
      <span id="openKeyLabel">Ø±Ù…Ø²ÛŒ Ú©Ù‡ Ø¨Ø§ Ø¢Ù† Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø¨Ø³ØªÙ‡ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒ:</span>
      <input id="openKeyInput" type="text" class="small-input" placeholder="Ø±Ù…Ø² Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³..." />
      <button id="openBtn">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ø³ØªÙ‡ Ø¨Ø§ Ø§ÛŒÙ† Ø±Ù…Ø²</button>
    </div>

    <div>
      <label for="openedPlain" id="openedPlainLabel">Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø§ Ø§ÛŒÙ† Ø±Ù…Ø² ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯:</label>
      <textarea id="openedPlain" readonly placeholder="Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ø³ØªÙ‡ØŒ Ø¬Ù…Ù„Ù‡Ù” Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ø±Ù…Ø² Ø§ÛŒÙ†Ø¬Ø§ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯."></textarea>
      <div id="openStatus" class="result-text"></div>
    </div>
  </div>

  <script>
    // --- Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§ÛŒÙ†Ø±ÛŒ Ùˆ Base64 ---
    const enc = new TextEncoder();
    const dec = new TextDecoder();

    // --- ØªÙ†Ø¸ÛŒÙ… Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ---
    const uiTexts = {
      fa: {
        appTitle: "Ø¨Ø³ØªÙ‡Ù” Ú†Ù†Ø¯Ù…ØªÙ†ÛŒ Ø¨Ø§ AES",
        description: "Ù‡Ø± Ø±Ø¯ÛŒÙ ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ùˆ ÛŒÚ© Ø±Ù…Ø² Ø¯Ø§Ø±Ø¯. Ø¨Ø³ØªÙ‡Ù” Ù†Ù‡Ø§ÛŒÛŒ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¨Ø§ Ù‡Ø± Ú©Ø¯Ø§Ù… Ø§Ø² Ø±Ù…Ø²Ù‡Ø§ Ø¨Ø§Ø² Ú©Ø±Ø¯ Ùˆ ÙÙ‚Ø· Ø¬Ù…Ù„Ù‡Ù” Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ù…Ø§Ù† Ø±Ù…Ø² Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
        section1Title: "Û±) ØªØ¹Ø±ÛŒÙ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ùˆ Ø±Ù…Ø²Ù‡Ø§",
        section2Title: "Û²) Ø³Ø§Ø®Øª Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡",
        section3Title: "Û³) Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ø³ØªÙ‡ Ø¨Ø§ ÛŒÚ© Ø±Ù…Ø²",
        columnsKeys: "Ø±Ù…Ø²Ù‡Ø§",
        columnsTexts: "Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§",
        addRow: "Ø§ÙØ²ÙˆØ¯Ù† Ø¬Ù…Ù„Ù‡Ù” Ø¬Ø¯ÛŒØ¯",
        clearRows: "Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ù‡Ù…Ù‡Ù” Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§",
        notePackage: "Ù…ØªÙ† Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù¾ÛŒ Ú©Ù†):",
        encryptBtn: "ØªÙˆÙ„ÛŒØ¯ Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ Ø§Ø² Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ùˆ Ø±Ù…Ø²Ù‡Ø§",
        minRecordsLabel: "Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø¨Ø³ØªÙ‡:",
        minRecordsTooltip: "Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø¨Ø³ØªÙ‡ (Ø¬Ù…Ù„Ù‡Ù” ÙˆØ§Ù‚Ø¹ÛŒ + Ø¬Ù…Ù„Ù‡Ù” padding). Ø¹Ø¯Ø¯ Ø¨Ø²Ø±Ú¯â€ŒØªØ±ØŒ Ø­Ø¯Ø³â€ŒØ²Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ Ø³Ø®Øªâ€ŒØªØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.",
        packagePlaceholder: "Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø³ØªÙ‡Ù” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ ÛŒØ§ Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡...",
        openSectionKeyLabel: "Ø±Ù…Ø²ÛŒ Ú©Ù‡ Ø¨Ø§ Ø¢Ù† Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø¨Ø³ØªÙ‡ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒ:",
        openKeyPlaceholder: "Ø±Ù…Ø² Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³...",
        openBtn: "Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ø³ØªÙ‡ Ø¨Ø§ Ø§ÛŒÙ† Ø±Ù…Ø²",
        openedPlainLabel: "Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø§ Ø§ÛŒÙ† Ø±Ù…Ø² ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯:",
        openedPlainPlaceholder: "Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ø³ØªÙ‡ØŒ Ø¬Ù…Ù„Ù‡Ù” Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ø±Ù…Ø² Ø§ÛŒÙ†Ø¬Ø§ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.",
        encryptNeedOne: "Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ùˆ Ø±Ù…Ø² Ù…Ø¹ØªØ¨Ø± Ù„Ø§Ø²Ù… Ø§Ø³Øª.",
        encryptSuccess: "Ø¨Ø³ØªÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø¢Ù† Ø±Ø§ Ú©Ù¾ÛŒ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒ.",
        encryptError: "Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†.",
        openNeedBoth: "Ø¨Ø³ØªÙ‡ Ùˆ Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†.",
        openSuccess: "Ø¬Ù…Ù„Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.",
        openNotFound: "Ù‡ÛŒÚ† Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø±Ù…Ø² Ø¯Ø± Ø¨Ø³ØªÙ‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.",
        openInvalid: "Ø¨Ø³ØªÙ‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª ÛŒØ§ Ø®Ø±Ø§Ø¨ Ø´Ø¯Ù‡ Ø§Ø³Øª.",
        confirmClear: "Ù‡Ù…Ù‡Ù” Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´ÙˆÙ†Ø¯ØŸ",
		langLabel: "UI language:",
        langFa: "ÙØ§Ø±Ø³ÛŒ",
        langEn: "English"
      },
      en: {
        appTitle: "AES Multi-Message Package",
        description: "Each row has a sentence and a key. The final package can be opened with any of the keys, and only the sentence belonging to that key will be shown.",
        section1Title: "1) Define sentences and keys",
        section2Title: "2) Build encrypted package",
        section3Title: "3) Open the package with a key",
        columnsKeys: "Keys",
        columnsTexts: "Sentences",
        addRow: "Add new sentence",
        clearRows: "Clear all rows",
        notePackage: "Encrypted package text (copy it to save or send):",
        encryptBtn: "Generate encrypted package from sentences and keys",
        minRecordsLabel: "Minimum total sentences in package:",
        minRecordsTooltip: "Minimum total records inside the package (real sentences + padding sentences). A bigger number makes it harder to guess how many real sentences exist.",
        packagePlaceholder: "The encrypted package will be generated here, or paste one to open...",
        openSectionKeyLabel: "Key you want to open the package with:",
        openKeyPlaceholder: "Type the key here...",
        openBtn: "Open package with this key",
        openedPlainLabel: "Sentence that was generated with this key:",
        openedPlainPlaceholder: "After opening the package, the sentence for this key will appear here.",
        encryptNeedOne: "At least one valid sentence and key is required.",
        encryptSuccess: "Package created successfully. You can copy and save it.",
        encryptError: "An error occurred. Please try again.",
        openNeedBoth: "Enter the package and the key.",
        openSuccess: "Sentence recovered successfully.",
        openNotFound: "No sentence with this key was found in the package.",
        openInvalid: "The package is invalid or corrupted.",
        confirmClear: "Clear all rows?",
        langLabel: "Ø²Ø¨Ø§Ù† Ø±Ø§Ø¨Ø·:",
        langFa: "Persian",
        langEn: "English"
      }
    };

    let currentLang = "fa";

    function getSentenceLabel(lang, index) {
      if (lang === "fa") {
        return "Ø¬Ù…Ù„Ù‡Ù” " + index;
      }
      return "Sentence " + index;
    }

    function getSentencePlaceholder(lang, index) {
      if (lang === "fa") {
        return "Ø¬Ù…Ù„Ù‡Ù” " + index + " Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³...";
      }
      return "Write sentence " + index + " here...";
    }

    function getKeyLabel(lang, index) {
      if (lang === "fa") {
        return "Ø±Ù…Ø² Ø¬Ù…Ù„Ù‡Ù” " + index;
      }
      return "Key for sentence " + index;
    }

    function getKeyPlaceholder(lang, index) {
      if (lang === "fa") {
        return "Ø±Ù…Ø² Ø¬Ù…Ù„Ù‡Ù” " + index;
      }
      return "Sentence " + index + " key";
    }

    // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ ØªÙˆØ§Ø¨Ø¹ padding ---
    const PADDING_TEXT = "This is a useless text.";
    const DEFAULT_MIN_TOTAL_RECORDS = 111;
    const PADDING_KEY_MIN_LENGTH = 35;
    const PADDING_KEY_CHARSET =
      "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%^&*()-_=+[]{}";

    function randomPaddingKey(length) {
      const chars = PADDING_KEY_CHARSET;
      const len = Math.max(length, PADDING_KEY_MIN_LENGTH);
      const arr = new Uint32Array(len);
      crypto.getRandomValues(arr);
      let result = "";
      for (let i = 0; i < len; i++) {
        result += chars[arr[i] % chars.length];
      }
      return result;
    }

    function isKeyTooSimilar(key, existingKeys) {
      const lowerKey = key.toLowerCase();
      return existingKeys.some((k) => {
        const lowerExisting = k.toLowerCase();
        return (
          lowerExisting.includes(lowerKey) ||
          lowerKey.includes(lowerExisting) ||
          sharesLongSubstring(lowerKey, lowerExisting)
        );
      });
    }

    function sharesLongSubstring(a, b, minLen = 5) {
      if (!a || !b) return false;
      if (a.length < minLen || b.length < minLen) return false;

      let shorter = a;
      let longer = b;
      if (b.length < a.length) {
        shorter = b;
        longer = a;
      }

      for (let i = 0; i <= shorter.length - minLen; i++) {
        const sub = shorter.slice(i, i + minLen);
        if (longer.includes(sub)) {
          return true;
        }
      }
      return false;
    }

    function bufToBase64(buf) {
      const bytes = new Uint8Array(buf);
      let binary = "";
      for (let i = 0; i < bytes.length; i++) {
        binary += String.fromCharCode(bytes[i]);
      }
      return btoa(binary);
    }

    function base64ToBuf(base64) {
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);
      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }
      return bytes.buffer;
    }

    async function deriveKeyFromPassword(password, salt) {
      const keyMaterial = await crypto.subtle.importKey(
        "raw",
        enc.encode(password),
        { name: "PBKDF2" },
        false,
        ["deriveKey"]
      );

      return crypto.subtle.deriveKey(
        {
          name: "PBKDF2",
          salt,
          iterations: 120000,
          hash: "SHA-256",
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
      );
    }

    async function encryptAESGCM(plainText, password) {
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const key = await deriveKeyFromPassword(password, salt);
      const iv = crypto.getRandomValues(new Uint8Array(12));

      const cipherBuf = await crypto.subtle.encrypt(
        { name: "AES-GCM", iv },
        key,
        enc.encode(plainText)
      );

      return {
        salt: bufToBase64(salt.buffer),
        iv: bufToBase64(iv.buffer),
        data: bufToBase64(cipherBuf),
      };
    }

    async function decryptAESGCM(record, password) {
      const salt = new Uint8Array(base64ToBuf(record.salt));
      const iv = new Uint8Array(base64ToBuf(record.iv));
      const ciphertext = base64ToBuf(record.data);

      const key = await deriveKeyFromPassword(password, salt);

      const plainBuf = await crypto.subtle.decrypt(
        { name: "AES-GCM", iv },
        key,
        ciphertext
      );

      return dec.decode(plainBuf);
    }

    const pairsContainer = document.getElementById("pairsContainer");
    const addRowBtn = document.getElementById("addRowBtn");
    const addRowBtnText = document.getElementById("addRowBtnText");
    const clearRowsBtn = document.getElementById("clearRowsBtn");

    const encryptBtn = document.getElementById("encryptBtn");
    const packageText = document.getElementById("packageText");
    const encryptStatus = document.getElementById("encryptStatus");
    const minRecordsInput = document.getElementById("minRecordsInput");
    const minRecordsHelp = document.getElementById("minRecordsHelp");
    const minRecordsTooltip = document.getElementById("minRecordsTooltip");

    const openBtn = document.getElementById("openBtn");
    const openKeyInput = document.getElementById("openKeyInput");
    const openedPlain = document.getElementById("openedPlain");
    const openStatus = document.getElementById("openStatus");

    const appTitleEl = document.getElementById("appTitle");
    const appDescriptionEl = document.getElementById("appDescription");
    const section1TitleEl = document.getElementById("section1Title");
    const section2TitleEl = document.getElementById("section2Title");
    const section3TitleEl = document.getElementById("section3Title");
    const columnsKeysLabelEl = document.getElementById("columnsKeysLabel");
    const columnsTextsLabelEl = document.getElementById("columnsTextsLabel");
    const packageNoteEl = document.getElementById("packageNote");
    const minRecordsLabelEl = document.getElementById("minRecordsLabel");
    const openKeyLabelEl = document.getElementById("openKeyLabel");
    const openedPlainLabelEl = document.getElementById("openedPlainLabel");

    const langSelectLabel = document.getElementById("langSelectLabel");
    const langBtnFa = document.getElementById("langBtnFa");
    const langBtnEn = document.getElementById("langBtnEn");
    const langBtnFaText = document.getElementById("langBtnFaText");
    const langBtnEnText = document.getElementById("langBtnEnText");

    let rowCount = 0;

    function applyLanguageToStaticTexts(lang) {
      const t = uiTexts[lang] || uiTexts.fa;

      if (appTitleEl) appTitleEl.textContent = t.appTitle;
      if (appDescriptionEl) appDescriptionEl.textContent = t.description;
      if (section1TitleEl) section1TitleEl.textContent = t.section1Title;
      if (section2TitleEl) section2TitleEl.textContent = t.section2Title;
      if (section3TitleEl) section3TitleEl.textContent = t.section3Title;
      if (columnsKeysLabelEl) columnsKeysLabelEl.textContent = t.columnsKeys;
      if (columnsTextsLabelEl) columnsTextsLabelEl.textContent = t.columnsTexts;
      if (packageNoteEl) packageNoteEl.textContent = t.notePackage;
      if (minRecordsLabelEl) minRecordsLabelEl.textContent = t.minRecordsLabel;
      if (minRecordsTooltip) minRecordsTooltip.textContent = t.minRecordsTooltip;
      if (encryptBtn) encryptBtn.textContent = t.encryptBtn;
      if (packageText) packageText.placeholder = t.packagePlaceholder;
      if (openKeyLabelEl) openKeyLabelEl.textContent = t.openSectionKeyLabel;
      if (openKeyInput) openKeyInput.placeholder = t.openKeyPlaceholder;
      if (openBtn) openBtn.textContent = t.openBtn;
      if (openedPlainLabelEl) openedPlainLabelEl.textContent = t.openedPlainLabel;
      if (openedPlain) openedPlain.placeholder = t.openedPlainPlaceholder;
      if (addRowBtnText) addRowBtnText.textContent = t.addRow;
      if (clearRowsBtn) clearRowsBtn.textContent = t.clearRows;
      if (langSelectLabel) langSelectLabel.textContent = t.langLabel;
      if (langBtnFaText) langBtnFaText.textContent = t.langFa;
      if (langBtnEnText) langBtnEnText.textContent = t.langEn;
    }

    function updateRowTextsForLanguage(lang) {
      const rows = pairsContainer.querySelectorAll(".pair-row");
      rows.forEach((row) => {
        const index = row.dataset.index || "1";
        const textLabel = row.querySelector(".text-group label");
        const textArea = row.querySelector(".plain-input");
        const keyLabel = row.querySelector(".key-group label");
        const keyInput = row.querySelector(".key-input");

        if (textLabel) textLabel.textContent = getSentenceLabel(lang, index);
        if (textArea && !textArea.value) {
          textArea.placeholder = getSentencePlaceholder(lang, index);
        }
        if (keyLabel) keyLabel.textContent = getKeyLabel(lang, index);
        if (keyInput && !keyInput.value) {
          keyInput.placeholder = getKeyPlaceholder(lang, index);
        }
      });
    }

    function setLanguage(lang) {
      if (!uiTexts[lang]) {
        lang = "fa";
      }
      currentLang = lang;

      document.documentElement.lang = lang === "fa" ? "fa" : "en";
      document.body.setAttribute("dir", lang === "fa" ? "rtl" : "ltr");

      if (langBtnFa && langBtnEn) {
        langBtnFa.classList.toggle("active", lang === "fa");
        langBtnEn.classList.toggle("active", lang === "en");
      }

      applyLanguageToStaticTexts(lang);
      updateRowTextsForLanguage(lang);
    }

    function addRow() {
      rowCount++;
      const rowIndex = rowCount;

      const row = document.createElement("div");
      row.className = "pair-row";
      row.dataset.index = rowIndex;

      const textGroup = document.createElement("div");
      textGroup.className = "field-group text-group";
      const textLabel = document.createElement("label");
      textLabel.textContent = getSentenceLabel(currentLang, rowIndex);
      const textArea = document.createElement("textarea");
      textArea.placeholder = getSentencePlaceholder(currentLang, rowIndex);
      textArea.className = "plain-input";
      textGroup.appendChild(textLabel);
      textGroup.appendChild(textArea);

      const keyGroup = document.createElement("div");
      keyGroup.className = "field-group key-group";
      const keyLabel = document.createElement("label");
      keyLabel.textContent = getKeyLabel(currentLang, rowIndex);
      const keyInput = document.createElement("input");
      keyInput.type = "text";
      keyInput.placeholder = getKeyPlaceholder(currentLang, rowIndex);
      keyInput.className = "key-input";
      keyGroup.appendChild(keyLabel);
      keyGroup.appendChild(keyInput);

      const removeBtn = document.createElement("button");
      removeBtn.className = "remove-btn";
      removeBtn.textContent = "Ã—";
      removeBtn.addEventListener("click", () => {
        row.remove();
      });

      row.appendChild(keyGroup);
      row.appendChild(textGroup);
      row.appendChild(removeBtn);

      pairsContainer.appendChild(row);
    }

    addRowBtn.addEventListener("click", () => {
      addRow();
    });

    clearRowsBtn.addEventListener("click", () => {
      if (confirm(uiTexts[currentLang].confirmClear)) {
        pairsContainer.innerHTML = "";
        rowCount = 0;
        addRow();
        addRow();
        packageText.value = "";
        encryptStatus.textContent = "";
        openKeyInput.value = "";
        openedPlain.value = "";
        openStatus.textContent = "";
        updateRowTextsForLanguage(currentLang);
      }
    });

    let minRecordsTooltipTimer = null;
    if (minRecordsHelp && minRecordsTooltip) {
      minRecordsHelp.addEventListener("mouseenter", () => {
        minRecordsTooltipTimer = setTimeout(() => {
          minRecordsTooltip.classList.add("visible");
        }, 500);
      });

      minRecordsHelp.addEventListener("mouseleave", () => {
        if (minRecordsTooltipTimer) {
          clearTimeout(minRecordsTooltipTimer);
          minRecordsTooltipTimer = null;
        }
        minRecordsTooltip.classList.remove("visible");
      });
    }

    encryptBtn.addEventListener("click", async () => {
      try {
        const records = [];
        const userKeys = [];
        const rows = pairsContainer.querySelectorAll(".pair-row");

        for (const row of rows) {
          const plain = row.querySelector(".plain-input").value.trim();
          const key = row.querySelector(".key-input").value.trim();
          if (!plain || !key) continue;

          const rec = await encryptAESGCM(plain, key);
          records.push(rec);
          userKeys.push(key);
        }

        if (records.length === 0) {
          encryptStatus.textContent = uiTexts[currentLang].encryptNeedOne;
          return;
        }

        const allKeys = userKeys.slice();
        const currentCount = records.length;

        let minTotalRecords = Math.max(DEFAULT_MIN_TOTAL_RECORDS, currentCount);
        if (minRecordsInput) {
          const raw = String(minRecordsInput.value || "").trim();
          const parsed = parseInt(raw, 10);
          if (!Number.isNaN(parsed) && parsed > 0) {
            minTotalRecords = Math.max(parsed, currentCount);
          }
        }

        const neededPadding = Math.max(0, minTotalRecords - currentCount);

        for (let i = 0; i < neededPadding; i++) {
          let padKey;
          let attempts = 0;

          do {
            padKey = randomPaddingKey(PADDING_KEY_MIN_LENGTH);
            attempts++;
            if (attempts > 100) {
              break;
            }
          } while (isKeyTooSimilar(padKey, allKeys));

          const paddingRecord = await encryptAESGCM(PADDING_TEXT, padKey);
          records.push(paddingRecord);
          allKeys.push(padKey);
        }

        const json = JSON.stringify(records);
        const base64Package = bufToBase64(enc.encode(json));
        packageText.value = base64Package;
        encryptStatus.textContent = uiTexts[currentLang].encryptSuccess;
      } catch (e) {
        console.error(e);
        encryptStatus.textContent = uiTexts[currentLang].encryptError;
      }
    });

    openBtn.addEventListener("click", async () => {
      openedPlain.value = "";
      openStatus.textContent = "";

      const pkg = packageText.value.trim();
      const key = openKeyInput.value.trim();

      if (!pkg || !key) {
        openStatus.textContent = uiTexts[currentLang].openNeedBoth;
        return;
      }

      try {
        const jsonStr = dec.decode(base64ToBuf(pkg));
        const records = JSON.parse(jsonStr);

        let found = false;
        for (const rec of records) {
          try {
            const plain = await decryptAESGCM(rec, key);
            if (plain === PADDING_TEXT) {
              continue;
            }
            openedPlain.value = plain;
            openStatus.textContent = uiTexts[currentLang].openSuccess;
            found = true;
            break;
          } catch (err) {
            // ignore and continue
          }
        }

        if (!found) {
          openStatus.textContent = uiTexts[currentLang].openNotFound;
        }
      } catch (e) {
        console.error(e);
        openStatus.textContent = uiTexts[currentLang].openInvalid;
      }
    });

    // ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    if (langBtnFa) {
      langBtnFa.addEventListener("click", () => setLanguage("fa"));
    }
    if (langBtnEn) {
      langBtnEn.addEventListener("click", () => setLanguage("en"));
    }

    // Ø´Ø±ÙˆØ¹ Ø¨Ø§ Ø¯Ùˆ Ø±Ø¯ÛŒÙ Ù†Ù…ÙˆÙ†Ù‡ Ùˆ Ø§Ø¹Ù…Ø§Ù„ Ø²Ø¨Ø§Ù† Ø§ÙˆÙ„ÛŒÙ‡
    addRow();
    addRow();
    setLanguage(currentLang);
  </script>
</body>
</html>
